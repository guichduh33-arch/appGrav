## üîç Error Analysis

**Error:** 500 Internal Server Error
**File:** Unknown (need more context)
**Line:** Unknown
**Type:** Server Error (likely Supabase RLS policy blocking request)

## üéØ Root Cause

This is a classic Supabase RLS (Row Level Security) policy error. The server is rejecting the request because:
1. RLS policies are blocking access to the data
2. User doesn't have proper authentication
3. Policies are too restrictive for the current operation

## ‚úÖ Solution

### Step 1: Check Browser Console for Details

Open browser console (F12) and look for more specific error messages. You should see something like:
- "new row violates row-level security policy"
- "permission denied for table"

### Step 2: Test Database Connection

**In browser console, run:**
```javascript
// Test basic connection
const { data, error } = await supabase.from('products').select('*').limit(1);
console.log('Data:', data, 'Error:', error);

// Check auth state
const { data: { user } } = await supabase.auth.getUser();
console.log('Current user:', user);
```

### Step 3: Fix RLS Policies (Choose based on your needs)

**Option A: Quick Fix - Make tables public (TEMPORARY)**

Go to Supabase Dashboard ‚Üí SQL Editor and run:
```sql
-- Make products table accessible
DROP POLICY IF EXISTS "products_public_read" ON products;
CREATE POLICY "products_public_read"
  ON products FOR SELECT
  TO anon, authenticated
  USING (true);

-- Make categories table accessible
DROP POLICY IF EXISTS "categories_public_read" ON categories;
CREATE POLICY "categories_public_read"
  ON categories FOR SELECT
  TO anon, authenticated
  USING (true);

-- Make orders table accessible for authenticated users
DROP POLICY IF EXISTS "orders_user_access" ON orders;
CREATE POLICY "orders_user_access"
  ON orders FOR ALL
  TO authenticated
  USING (true)
  WITH CHECK (true);

-- Make order_items accessible
DROP POLICY IF EXISTS "order_items_user_access" ON order_items;
CREATE POLICY "order_items_user_access"
  ON order_items FOR ALL
  TO authenticated
  USING (true)
  WITH CHECK (true);
```

**Option B: Proper Fix - User-specific policies**

```sql
-- Products: Public read access
CREATE POLICY "products_public_read" ON products
  FOR SELECT TO anon, authenticated
  USING (true);

-- Orders: Users can only see their own orders
CREATE POLICY "orders_user_own" ON orders
  FOR ALL TO authenticated
  USING (auth.uid() = user_id)
  WITH CHECK (auth.uid() = user_id);

-- Order items: Users can access items from their orders
CREATE POLICY "order_items_user_own" ON order_items
  FOR ALL TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM orders 
      WHERE orders.id = order_items.order_id 
      AND orders.user_id = auth.uid()
    )
  );
```

### Step 4: If Auth Issues, Check Authentication

**File to check:** `src/lib/supabase.ts`

**Ensure it looks like this:**
```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'your-project-url';
const supabaseKey = 'your-anon-key';

export const supabase = createClient(supabaseUrl, supabaseKey);
```

### Step 5: Add Error Handling to API Calls

**Find any file making Supabase calls and wrap them:**

**Before:**
```typescript
const { data } = await supabase.from('products').select('*');
```

**After:**
```typescript
const { data, error } = await supabase.from('products').select('*');
if (error) {
  console.error('Supabase error:', error);
  throw new Error(`Database error: ${error.message}`);
}
```

## üìù Explanation

500 Internal Server Errors in Supabase are almost always RLS policy issues. The server receives the request but rejects it due to security policies. By updating the policies to allow appropriate access, the error will resolve.

## üõ°Ô∏è Prevention

1. **Always test RLS policies** after creating them
2. **Use proper error handling** in all database calls
3. **Check auth state** before making authenticated requests
4. **Start with permissive policies** during development, then tighten them

## üö® Need More Context?

If this doesn't fix it, please share:
1. The specific page/component where error occurs
2. Browser console error details
3. What action triggers the error (loading page, clicking button, etc.)

**Quick Test:** Try accessing `http://localhost:5173` and check if the error appears on page load or during a specific action.