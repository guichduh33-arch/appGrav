-- Fix Supabase security advisor WARNs: functions with mutable search_path
-- Set search_path = '' on all 55 public functions

ALTER FUNCTION public.add_loyalty_points(p_customer_id uuid, p_order_id uuid, p_order_amount numeric, p_created_by uuid) SET search_path = '';
ALTER FUNCTION public.calculate_vat_payable(p_year integer, p_month integer) SET search_path = '';
ALTER FUNCTION public.cleanup_old_records() SET search_path = '';
ALTER FUNCTION public.close_shift(p_session_id uuid, p_actual_cash numeric, p_actual_qris numeric, p_actual_edc numeric, p_closed_by character varying, p_notes text) SET search_path = '';
ALTER FUNCTION public.create_purchase_journal_entry() SET search_path = '';
ALTER FUNCTION public.create_sale_journal_entry() SET search_path = '';
ALTER FUNCTION public.current_user_can(p_permission character varying) SET search_path = '';
ALTER FUNCTION public.deduct_stock_on_sale_items() SET search_path = '';
ALTER FUNCTION public.finalize_inventory_count(count_uuid uuid) SET search_path = '';
ALTER FUNCTION public.generate_b2b_delivery_number() SET search_path = '';
ALTER FUNCTION public.generate_b2b_order_number() SET search_path = '';
ALTER FUNCTION public.generate_b2b_payment_number() SET search_path = '';
ALTER FUNCTION public.generate_count_number() SET search_path = '';
ALTER FUNCTION public.generate_customer_qr_code() SET search_path = '';
ALTER FUNCTION public.generate_movement_id() SET search_path = '';
ALTER FUNCTION public.generate_next_customer_invoice_number() SET search_path = '';
ALTER FUNCTION public.generate_next_invoice_number(p_order_id uuid) SET search_path = '';
ALTER FUNCTION public.generate_order_number() SET search_path = '';
ALTER FUNCTION public.generate_po_number() SET search_path = '';
ALTER FUNCTION public.generate_production_id() SET search_path = '';
ALTER FUNCTION public.generate_session_number() SET search_path = '';
ALTER FUNCTION public.generate_transfer_number() SET search_path = '';
ALTER FUNCTION public.get_account_balance(p_account_id uuid, p_end_date date) SET search_path = '';
ALTER FUNCTION public.get_balance_sheet_data(p_end_date date) SET search_path = '';
ALTER FUNCTION public.get_current_user_profile_id() SET search_path = '';
ALTER FUNCTION public.get_customer_product_price(p_product_id uuid, p_customer_category_slug character varying) SET search_path = '';
ALTER FUNCTION public.get_income_statement_data(p_start_date date, p_end_date date) SET search_path = '';
ALTER FUNCTION public.get_ingredient_deduction_section(p_ingredient_id uuid, p_consuming_section_id uuid) SET search_path = '';
ALTER FUNCTION public.get_next_daily_sequence(p_sequence_name character varying, p_date date) SET search_path = '';
ALTER FUNCTION public.get_production_suggestions_data(p_lookback_days integer, p_priority_high_threshold numeric, p_priority_medium_threshold numeric) SET search_path = '';
ALTER FUNCTION public.get_reorder_suggestions_data(p_lookback_days integer, p_max_multiplier numeric) SET search_path = '';
ALTER FUNCTION public.get_reporting_dashboard_summary(start_date timestamp with time zone, end_date timestamp with time zone) SET search_path = '';
ALTER FUNCTION public.get_sales_comparison(current_start timestamp with time zone, current_end timestamp with time zone, previous_start timestamp with time zone, previous_end timestamp with time zone) SET search_path = '';
ALTER FUNCTION public.get_settings_by_category(p_category_code character varying) SET search_path = '';
ALTER FUNCTION public.get_terminal_open_shifts(p_terminal_id character varying) SET search_path = '';
ALTER FUNCTION public.get_trial_balance_data(p_end_date date) SET search_path = '';
ALTER FUNCTION public.get_user_open_shift(p_user_id uuid) SET search_path = '';
ALTER FUNCTION public.get_user_permissions(p_user_id uuid) SET search_path = '';
ALTER FUNCTION public.handle_new_user() SET search_path = '';
ALTER FUNCTION public.hash_session_token() SET search_path = '';
ALTER FUNCTION public.is_admin(p_user_id uuid) SET search_path = '';
ALTER FUNCTION public.next_journal_entry_number(p_prefix character varying) SET search_path = '';
ALTER FUNCTION public.open_shift(p_opening_cash numeric, p_terminal_id character varying, p_notes text) SET search_path = '';
ALTER FUNCTION public.record_stock_before_after() SET search_path = '';
ALTER FUNCTION public.redeem_loyalty_points(p_customer_id uuid, p_points integer, p_order_id uuid, p_description text, p_created_by uuid) SET search_path = '';
ALTER FUNCTION public.reset_category_settings(p_category_code character varying) SET search_path = '';
ALTER FUNCTION public.reset_setting(p_key character varying) SET search_path = '';
ALTER FUNCTION public.sync_product_total_stock() SET search_path = '';
ALTER FUNCTION public.update_b2b_order_totals() SET search_path = '';
ALTER FUNCTION public.update_lan_node_heartbeat(p_device_id character varying) SET search_path = '';
ALTER FUNCTION public.update_product_stock() SET search_path = '';
ALTER FUNCTION public.update_setting(p_key character varying, p_value jsonb, p_reason text) SET search_path = '';
ALTER FUNCTION public.update_settings_bulk(p_settings jsonb) SET search_path = '';
ALTER FUNCTION public.update_updated_at() SET search_path = '';
ALTER FUNCTION public.user_has_permission(p_user_id uuid, p_permission_code character varying) SET search_path = '';
